# 🧪 Google Apps Script環境での実装テストガイド

**作成日**: 2025年10月19日  
**対象**: Phase 0・Phase 1実装の実際の環境での動作確認  
**前提条件**: GitHubへのプッシュ完了

---

## 📋 テスト実行手順

### ステップ1: Google Apps Script環境へのアクセス

1. **Google Sheetsを開く**
   - 営業自動化システムのスプレッドシートにアクセス
   - URL: `https://docs.google.com/spreadsheets/d/1Q4i_GjDX1x_hWbqvRJDrmqizZMOZ8q-FjX_pf7eGPlM/edit`

2. **Apps Scriptエディタを開く**
   - メニュー「拡張機能」→「Apps Script」を選択
   - Script ID: `1CJc_NYpMJ8veccfqtRbcf0C02a5eR24zcUxGJiP7SU_pf4g-vK6AHfSy`

### ステップ2: コードの更新確認

1. **ファイル一覧を確認**
   ```
   ✅ 新規追加されているべきファイル:
   - plan-manager.js
   - usage-tracker.js  
   - limit-checker.js
   - phase0-validator.js
   - phase1-validator.js
   
   📝 更新されているべきファイル:
   - license-manager.js
   - user-manager.js
   - main-menu.js
   - main.js
   ```

2. **コードが最新版に更新されているか確認**
   - GitHubと同期されていない場合は、clasp pushまたは手動コピーが必要

---

## 🚀 システム初期化テスト

### Phase 0: プラン管理システム初期化

1. **Apps Scriptエディタで実行**
   ```javascript
   // 関数名: initializePlanManager
   // 実行方法: 関数選択 → 実行ボタンクリック
   ```

2. **期待される結果**
   ```
   ✅ ログ出力: "🚀 プラン管理システム初期化開始..."
   ✅ ログ出力: "📊 現在のプラン: 🆓 試用期間"（初回実行時）
   ✅ ログ出力: "✅ プラン管理システム初期化完了"
   ❌ エラーなし
   ```

3. **確認方法**
   ```javascript
   // 初期化後にこの関数を実行してプラン情報確認
   showPlanManagementInfo()
   ```

### Phase 1: 使用量追跡システム初期化

1. **Apps Scriptエディタで実行**
   ```javascript
   // 関数名: initializeUsageTracker
   // 実行方法: 関数選択 → 実行ボタンクリック
   ```

2. **期待される結果**
   ```
   ✅ ログ出力: "🚀 使用量追跡システム初期化開始..."
   ✅ ログ出力: "✅ 日次使用量リセットトリガー設定完了"
   ✅ ログ出力: "📊 今日の使用量: {各種使用量データ}"
   ✅ ログ出力: "✅ 使用量追跡システム初期化完了"
   ```

3. **制限チェックシステム初期化**
   ```javascript
   // 関数名: initializeLimitCheckSystem
   // 実行方法: 関数選択 → 実行ボタンクリック
   ```

---

## 🧪 動作検証テスト

### 検証スクリプト実行

1. **Phase 0検証**
   ```javascript
   // 関数名: runPhase0Validation
   // 実行方法: 関数選択 → 実行ボタンクリック
   ```
   
   **期待結果**: 検証レポートダイアログが表示され、すべてのテストが✅成功

2. **Phase 1検証**
   ```javascript
   // 関数名: runPhase1Validation
   // 実行方法: 関数選択 → 実行ボタンクリック
   ```
   
   **期待結果**: 使用量制限システムの検証レポートが表示され、すべてのテストが✅成功

### システムデモンストレーション

1. **使用量制限システムデモ**
   ```javascript
   // 関数名: demonstrateUsageLimitSystem
   // 実行方法: 関数選択 → 実行ボタンクリック
   ```
   
   **期待結果**: 現在のプラン情報・使用量・制限チェック結果が表示される

2. **使用量ダッシュボード**
   ```javascript
   // 関数名: showUsageDashboard
   // 実行方法: 関数選択 → 実行ボタンクリック
   ```

---

## 📊 実際の機能テスト

### メニューシステム統合テスト

1. **スプレッドシートに戻る**
   - Apps Scriptエディタを閉じて、スプレッドシートに戻る

2. **メニュー確認**
   ```
   ✅ メニューバーに「🚀 営業システム (🆓 試用期間)」が表示
   ✅ 「⚙️ 設定」→「🔧 システム設定」でプラン情報表示
   ```

3. **制御パネル確認**
   ```
   ✅ 制御パネルシートで「現在のプラン」項目が表示
   ✅ プラン情報が正しく更新されている
   ```

### プラン切り替えテスト（管理者のみ）

1. **管理者認証**
   ```javascript
   // 関数名: authenticateAdmin
   // パスワード: SalesAuto2024!
   ```

2. **プラン切り替えテスト**
   ```javascript
   // スタンダードプランに一時切り替え
   switchToTemporaryPlan('STANDARD')
   
   // メニュー確認（プラン名が変わることを確認）
   
   // 元のプランに復元
   restoreOriginalPlan()
   ```

### 使用量制限テスト

1. **企業検索制限テスト**
   ```javascript
   // 使用量を人為的に増加
   UsageTracker.incrementUsage(USAGE_TYPES.COMPANY_SEARCH, 3)
   
   // 制限チェック
   checkPlanLimit('company_search', 1)
   
   // 結果確認: 試用期間は5社/日制限
   ```

2. **機能制限テスト**
   ```javascript
   // ベーシックプランに切り替え後
   checkPlanLimit('keyword_generation', 1)
   // 結果: ベーシックプランではキーワード生成が制限される
   ```

---

## ⚠️ トラブルシューティング

### よくある問題と解決方法

#### 1. 関数が見つからないエラー
```
原因: ファイルが正しくアップロードされていない
解決: 
1. GitHubで最新コードを確認
2. clasp pushまたは手動でコードコピー
3. Apps Scriptエディタで保存・リロード
```

#### 2. PropertiesServiceエラー
```
原因: 権限不足またはスクリプト設定問題
解決:
1. スクリプトを一度保存
2. 初期化関数を再実行
3. 必要に応じて権限を再承認
```

#### 3. トリガー設定エラー
```
原因: トリガー作成権限の問題
解決:
1. 手動でsetupDailyUsageResetTrigger()を実行
2. Apps Scriptのトリガー画面で設定確認
```

#### 4. メニューが更新されない
```
原因: スプレッドシートのキャッシュ
解決:
1. スプレッドシートをリロード
2. onOpen()関数を手動実行
3. createSpecCompliantMenu()を実行
```

---

## 📈 性能・動作確認ポイント

### 必須確認項目

- [ ] プラン管理システム初期化成功
- [ ] 使用量追跡システム初期化成功
- [ ] Phase 0検証スクリプト全テスト✅
- [ ] Phase 1検証スクリプト全テスト✅
- [ ] メニューにプラン名表示
- [ ] システム設定でプラン情報表示
- [ ] 制御パネルでプラン状況表示
- [ ] 使用量制限が正常に動作
- [ ] プラン切り替え機能動作（管理者のみ）
- [ ] エラーハンドリング適切に動作

### パフォーマンス確認

- [ ] 関数実行速度（各初期化関数5秒以内）
- [ ] メニュー表示速度（プラン情報込みで3秒以内）
- [ ] 使用量チェック速度（1秒以内）
- [ ] メモリ使用量（異常な増加なし）

---

## 🎯 次のステップ

### テスト完了後の次の作業

1. **Phase 2実装準備**
   - 現在のメニューシステムの詳細動作確認
   - プラン別メニュー差分の具体的な設計
   - UI/UX改善案の検討

2. **運用準備**
   - 定期的なシステム状況監視の設定
   - ユーザーガイドの作成
   - サポート体制の整備

3. **継続開発**
   - Phase 2: 動的メニューシステム
   - Phase 3: シート表示制御
   - Phase 4: 統合切り替えシステム
   - Phase 5: 最終統合・最適化

---

**📞 サポート**: テスト中に問題が発生した場合は、このガイドのトラブルシューティングを参照し、必要に応じて開発チームにお問い合わせください。

**🎊 完了確認**: すべてのテストが正常に完了したら、Phase 0・Phase 1の実装が正式に完了です！