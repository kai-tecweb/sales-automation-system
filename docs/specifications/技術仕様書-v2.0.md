# æŠ€è¡“ä»•æ§˜æ›¸ - å–¶æ¥­è‡ªå‹•åŒ–ã‚·ã‚¹ãƒ†ãƒ  v2.0

## ğŸ“‹ æŠ€è¡“æ¦‚è¦

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£
- **ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ **: Google Apps Script (GAS)
- **ãƒ©ãƒ³ã‚¿ã‚¤ãƒ **: V8 Engine
- **ãƒ‡ãƒ¼ã‚¿ã‚¹ãƒˆãƒ¬ãƒ¼ã‚¸**: Google Spreadsheets
- **ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ**: Clasp CLI
- **ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†**: Git + GitHub

### æŠ€è¡“ã‚¹ã‚¿ãƒƒã‚¯
```yaml
Runtime: Google Apps Script V8
Language: JavaScript ES6+
APIs:
  - OpenAI ChatGPT API v3.5-turbo
  - Google Custom Search API v1
  - Google Sheets API v4
Authentication: OAuth 2.0
Development Tools:
  - Clasp CLI
  - VS Code
  - Git
```

---

## ğŸ—ï¸ ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«è¨­è¨ˆ

### ã‚³ã‚¢ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«

#### 1. ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚·ã‚¹ãƒ†ãƒ  (`menu.js`)
```javascript
// ç®¡ç†è€…ãƒ»ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†é›¢ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚·ã‚¹ãƒ†ãƒ 
class AdaptiveMenuSystem {
  constructor() {
    this.licenseManager = new EnhancedLicenseManager();
    this.ui = SpreadsheetApp.getUi();
  }
  
  // ãƒ¡ã‚¤ãƒ³ãƒ¡ãƒ‹ãƒ¥ãƒ¼ç”Ÿæˆï¼ˆç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã«å¿œã˜ã¦åˆ†å²ï¼‰
  buildMainMenu() {
    const isAdminMode = this.licenseManager.getAdminModeStatus();
    const licenseStatus = this.licenseManager.checkLicenseValidity();
    
    if (!licenseStatus.isValid) {
      this.buildExpiredMenu();
      return;
    }
    
    if (isAdminMode) {
      this.buildAdminMenu();
    } else {
      this.buildUserMenu();
    }
  }
  
  // ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼
  buildUserMenu() {
    const menu = this.ui.createMenu('ğŸ“Š å–¶æ¥­æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ ');
    
    // åŸºæœ¬æ©Ÿèƒ½
    menu.addSubMenu(this.buildSearchMenu());
    menu.addSubMenu(this.buildProposalMenu());
    menu.addSubMenu(this.buildAnalysisMenu());
    menu.addSeparator();
    
    // ã‚µãƒãƒ¼ãƒˆæ©Ÿèƒ½
    menu.addSubMenu(this.buildHelpMenu());
    
    menu.addToUi();
  }
  
  // ç®¡ç†è€…ãƒ¡ãƒ‹ãƒ¥ãƒ¼
  buildAdminMenu() {
    const menu = this.ui.createMenu('ğŸ”§ å–¶æ¥­æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ  (ç®¡ç†è€…)');
    
    // é€šå¸¸æ©Ÿèƒ½
    menu.addSubMenu(this.buildSearchMenu());
    menu.addSubMenu(this.buildProposalMenu());
    menu.addSubMenu(this.buildAnalysisMenu());
    menu.addSeparator();
    
    // ç®¡ç†æ©Ÿèƒ½
    menu.addSubMenu(this.buildManagementMenu());
    menu.addSeparator();
    
    // ã‚µãƒãƒ¼ãƒˆæ©Ÿèƒ½
    menu.addSubMenu(this.buildHelpMenu());
    
    menu.addToUi();
  }
  
  // æœŸé™åˆ‡ã‚Œãƒ¡ãƒ‹ãƒ¥ãƒ¼
  buildExpiredMenu() {
    const menu = this.ui.createMenu('âš ï¸ ã‚·ã‚¹ãƒ†ãƒ æœŸé™åˆ‡ã‚Œ');
    
    menu.addItem('ğŸ“‹ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹çŠ¶æ³ç¢ºèª', 'showLicenseStatus');
    menu.addItem('ğŸ’³ èª²é‡‘æ‰‹ç¶šãã‚¬ã‚¤ãƒ‰', 'showPricingGuide');
    menu.addSeparator();
    menu.addItem('ğŸ” ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³', 'promptAdminLogin');
    
    menu.addToUi();
  }
  
  // æ¤œç´¢ãƒ¡ãƒ‹ãƒ¥ãƒ¼
  buildSearchMenu() {
    const searchMenu = this.ui.createMenu('ğŸ” ä¼æ¥­æ¤œç´¢ãƒ»åˆ†æ');
    
    searchMenu.addItem('ğŸ¯ ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆï¼ˆChatGPTï¼‰', 'generateKeywords');
    searchMenu.addItem('ğŸ¢ ä¼æ¥­æ¤œç´¢ï¼ˆGoogleï¼‰', 'searchCompanies');
    searchMenu.addItem('ğŸ“Š ãƒãƒƒãƒãƒ³ã‚°åˆ†æ', 'analyzeMatching');
    
    return searchMenu;
  }
  
  // ææ¡ˆæ›¸ãƒ¡ãƒ‹ãƒ¥ãƒ¼
  buildProposalMenu() {
    const proposalMenu = this.ui.createMenu('ğŸ“ ææ¡ˆæ›¸ä½œæˆ');
    
    proposalMenu.addItem('âœ¨ AIææ¡ˆæ›¸ç”Ÿæˆ', 'generateProposal');
    proposalMenu.addItem('ğŸ“‹ ææ¡ˆæ›¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ', 'insertProposalTemplate');
    proposalMenu.addItem('ğŸ¨ ãƒ—ãƒ¬ã‚¼ãƒ³è³‡æ–™ç”Ÿæˆ', 'generatePresentation');
    
    return proposalMenu;
  }
  
  // åˆ†æãƒ¡ãƒ‹ãƒ¥ãƒ¼
  buildAnalysisMenu() {
    const analysisMenu = this.ui.createMenu('ğŸ“ˆ åˆ†æãƒ»è©•ä¾¡');
    
    analysisMenu.addItem('ğŸ¯ ã‚¹ã‚³ã‚¢ãƒªãƒ³ã‚°å®Ÿè¡Œ', 'runScoring');
    analysisMenu.addItem('ğŸ“Š ãƒ¬ã‚¹ãƒãƒ³ã‚¹åˆ†æ', 'analyzeResponse');
    analysisMenu.addItem('ğŸ“‹ ãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ', 'generateReport');
    
    return analysisMenu;
  }
  
  // ç®¡ç†æ©Ÿèƒ½ãƒ¡ãƒ‹ãƒ¥ãƒ¼ï¼ˆç®¡ç†è€…é™å®šï¼‰
  buildManagementMenu() {
    const managementMenu = this.ui.createMenu('âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ ç®¡ç†');
    
    managementMenu.addItem('ğŸ” ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿', 'toggleAdminMode');
    managementMenu.addItem('ï¿½ ä½¿ç”¨é–‹å§‹æ—¥è¨­å®š', 'setLicenseStartDate');
    managementMenu.addItem('ğŸ’³ èª²é‡‘çŠ¶æ³ç®¡ç†', 'manageBilling');
    managementMenu.addSeparator();
    managementMenu.addItem('ï¿½ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š', 'showSystemSettings');
    managementMenu.addItem('ğŸ“Š åˆ©ç”¨çµ±è¨ˆè¡¨ç¤º', 'showUsageStatistics');
    managementMenu.addItem('ğŸ—‚ï¸ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ', 'exportSystemData');
    
    return managementMenu;
  }
  
  // ãƒ˜ãƒ«ãƒ—ãƒ¡ãƒ‹ãƒ¥ãƒ¼
  buildHelpMenu() {
    const helpMenu = this.ui.createMenu('â“ ãƒ˜ãƒ«ãƒ—ãƒ»ã‚µãƒãƒ¼ãƒˆ');
    
    helpMenu.addItem('ï¿½ ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰', 'showUserGuide');
    helpMenu.addItem('ğŸ’° æ–™é‡‘ãƒ»APIåˆ©ç”¨ã‚¬ã‚¤ãƒ‰', 'showPricingGuide');
    helpMenu.addItem('ğŸ”§ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°', 'showTroubleshooting');
    helpMenu.addSeparator();
    helpMenu.addItem('ğŸ“ ã‚µãƒãƒ¼ãƒˆå•ã„åˆã‚ã›', 'contactSupport');
    helpMenu.addItem('ï¿½ ã‚·ã‚¹ãƒ†ãƒ æ›´æ–°ç¢ºèª', 'checkSystemUpdates');
    
    return helpMenu;
  }
  
  // ãƒ©ã‚¤ã‚»ãƒ³ã‚¹çŠ¶æ³è¡¨ç¤º
  showLicenseStatus() {
    const licenseStatus = this.licenseManager.checkLicenseValidity();
    const startDate = this.licenseManager.settingsSheet.getRange('B3').getValue();
    const billingStatus = this.licenseManager.settingsSheet.getRange('B4').getValue();
    
    let message = 'ï¿½ ãƒ©ã‚¤ã‚»ãƒ³ã‚¹çŠ¶æ³\n\n';
    message += `ä½¿ç”¨é–‹å§‹æ—¥: ${startDate || 'æœªè¨­å®š'}\n`;
    message += `èª²é‡‘çŠ¶æ³: ${billingStatus}\n`;
    message += `æœ‰åŠ¹æ€§: ${licenseStatus.isValid ? 'âœ… æœ‰åŠ¹' : 'âŒ ç„¡åŠ¹'}\n`;
    message += `ç†ç”±: ${licenseStatus.reason}\n\n`;
    
    if (!licenseStatus.isValid) {
      message += 'ç¶™ç¶šåˆ©ç”¨ã«ã¯èª²é‡‘ãŒå¿…è¦ã§ã™ã€‚\n';
      message += 'ã€Œæ–™é‡‘ãƒ»APIåˆ©ç”¨ã‚¬ã‚¤ãƒ‰ã€ã§è©³ç´°ã‚’ã”ç¢ºèªãã ã•ã„ã€‚';
    }
    
    this.ui.alert('ãƒ©ã‚¤ã‚»ãƒ³ã‚¹çŠ¶æ³', message, this.ui.ButtonSet.OK);
  }
  
  // ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³
  promptAdminLogin() {
    const response = this.ui.prompt(
      'ğŸ” ç®¡ç†è€…ãƒ­ã‚°ã‚¤ãƒ³',
      'ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ï¼š',
      this.ui.ButtonSet.OK_CANCEL
    );
    
    if (response.getSelectedButton() === this.ui.Button.OK) {
      const inputPassword = response.getResponseText();
      const savedPassword = this.licenseManager.settingsSheet.getRange('B7').getValue();
      
      // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰æ¤œè¨¼ï¼ˆæš—å·åŒ–ã•ã‚ŒãŸã‚‚ã®ã¨æ¯”è¼ƒï¼‰
      if (Utilities.base64Encode(inputPassword) === savedPassword) {
        this.licenseManager.setAdminModeStatus(true);
        this.ui.alert('âœ… ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸ\n\nç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ã«åˆ‡ã‚Šæ›¿ã‚ã‚Šã¾ã—ãŸã€‚\nãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚');
      } else {
        this.ui.alert('âŒ ãƒ­ã‚°ã‚¤ãƒ³å¤±æ•—\n\nãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãŒæ­£ã—ãã‚ã‚Šã¾ã›ã‚“ã€‚');
      }
    }
  }
  
  // ã‚·ã‚¹ãƒ†ãƒ è¨­å®šè¡¨ç¤º
  showSystemSettings() {
    const sheet = this.licenseManager.settingsSheet;
    let message = 'âš™ï¸ ã‚·ã‚¹ãƒ†ãƒ è¨­å®š\n\n';
    
    for (let i = 2; i <= 7; i++) {
      const setting = sheet.getRange(i, 1).getValue();
      const value = sheet.getRange(i, 2).getValue();
      const description = sheet.getRange(i, 3).getValue();
      
      message += `${setting}: ${value}\n`;
      message += `  â†’ ${description}\n\n`;
    }
    
    this.ui.alert('ã‚·ã‚¹ãƒ†ãƒ è¨­å®š', message, this.ui.ButtonSet.OK);
  }
  
  // åˆ©ç”¨çµ±è¨ˆè¡¨ç¤º
  showUsageStatistics() {
    // å®Ÿè£…ä¾‹ï¼šå„æ©Ÿèƒ½ã®åˆ©ç”¨å›æ•°ã‚’è¿½è·¡
    let stats = 'ğŸ“Š åˆ©ç”¨çµ±è¨ˆ\n\n';
    stats += 'ã“ã®æ©Ÿèƒ½ã¯ä»Šå¾Œã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å®Ÿè£…äºˆå®šã§ã™ã€‚\n';
    stats += 'äºˆå®šæ©Ÿèƒ½ï¼š\n';
    stats += 'â€¢ APIåˆ©ç”¨å›æ•°è¿½è·¡\n';
    stats += 'â€¢ æ©Ÿèƒ½åˆ¥ä½¿ç”¨é »åº¦\n';
    stats += 'â€¢ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹çµ±è¨ˆ\n';
    stats += 'â€¢ ã‚³ã‚¹ãƒˆåˆ†æ';
    
    this.ui.alert('åˆ©ç”¨çµ±è¨ˆ', stats, this.ui.ButtonSet.OK);
  }
  
  // ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
  exportSystemData() {
    this.ui.alert(
      'ï¿½ï¸ ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ',
      'ã“ã®æ©Ÿèƒ½ã¯ä»Šå¾Œã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã§å®Ÿè£…äºˆå®šã§ã™ã€‚\n\näºˆå®šæ©Ÿèƒ½ï¼š\nâ€¢ è¨­å®šãƒ‡ãƒ¼ã‚¿ã®ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—\nâ€¢ åˆ©ç”¨å±¥æ­´ã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ\nâ€¢ ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­ãƒ¬ãƒãƒ¼ãƒˆ',
      this.ui.ButtonSet.OK
    );
  }
}

// ãƒ¡ãƒ‹ãƒ¥ãƒ¼åˆæœŸåŒ–é–¢æ•°
function onOpen() {
  const menuSystem = new AdaptiveMenuSystem();
  menuSystem.buildMainMenu();
}

// å„ãƒ¡ãƒ‹ãƒ¥ãƒ¼é …ç›®ã®å®Ÿè£…é–¢æ•°
function toggleAdminMode() {
  const licenseManager = new EnhancedLicenseManager();
  licenseManager.toggleAdminMode();
}

function setLicenseStartDate() {
  const licenseManager = new EnhancedLicenseManager();
  licenseManager.setLicenseStartDate();
}

function manageBilling() {
  const licenseManager = new EnhancedLicenseManager();
  licenseManager.manageBilling();
}

function showLicenseStatus() {
  const menuSystem = new AdaptiveMenuSystem();
  menuSystem.showLicenseStatus();
}

function promptAdminLogin() {
  const menuSystem = new AdaptiveMenuSystem();
  menuSystem.promptAdminLogin();
}

function showSystemSettings() {
  const menuSystem = new AdaptiveMenuSystem();
  menuSystem.showSystemSettings();
}

function showUsageStatistics() {
  const menuSystem = new AdaptiveMenuSystem();
  menuSystem.showUsageStatistics();
}

function exportSystemData() {
  const menuSystem = new AdaptiveMenuSystem();
  menuSystem.exportSystemData();
}
---

## ğŸ”§ APIçµ±åˆä»•æ§˜

### OpenAI ChatGPT API

#### èªè¨¼
```javascript
const OPENAI_API_KEY = PropertiesService.getScriptProperties().getProperty('OPENAI_API_KEY');

const headers = {
  'Authorization': `Bearer ${OPENAI_API_KEY}`,
  'Content-Type': 'application/json'
};
```

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆå½¢å¼
```javascript
const requestBody = {
  model: 'gpt-3.5-turbo',
  messages: [
    {
      role: 'system',
      content: 'å–¶æ¥­æˆ¦ç•¥å°‚é–€å®¶ã¨ã—ã¦è¡Œå‹•ã—ã¦ãã ã•ã„'
    },
    {
      role: 'user',
      content: productAnalysisPrompt
    }
  ],
  max_tokens: 1000,
  temperature: 0.7
};
```

### Google Custom Search API

#### èªè¨¼ãƒ»è¨­å®š
```javascript
const GOOGLE_API_KEY = PropertiesService.getScriptProperties().getProperty('GOOGLE_API_KEY');
const CUSTOM_SEARCH_ENGINE_ID = PropertiesService.getScriptProperties().getProperty('CSE_ID');
```

#### æ¤œç´¢å®Ÿè¡Œ
```javascript
const searchUrl = `https://www.googleapis.com/customsearch/v1?key=${GOOGLE_API_KEY}&cx=${CUSTOM_SEARCH_ENGINE_ID}&q=${encodeURIComponent(query)}`;
```

---

## ğŸ“‹ ãƒ‡ãƒ¼ã‚¿ä»•æ§˜

### ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚·ãƒ¼ãƒˆ
| é …ç›® | ãƒ‡ãƒ¼ã‚¿å‹ | åˆ¶ç´„ | èª¬æ˜ |
|------|----------|------|------|
| ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰ | Boolean | true/false | ç®¡ç†è€…ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºåˆ¶å¾¡ |
| ä½¿ç”¨é–‹å§‹æ—¥ | Date | YYYY-MM-DD | 10å–¶æ¥­æ—¥è©¦ç”¨æœŸé–“ã®èµ·ç‚¹ |
| èª²é‡‘çŠ¶æ³ | String | trial/paid/expired | ãƒ©ã‚¤ã‚»ãƒ³ã‚¹çŠ¶æ…‹ |
| ç®¡ç†è€…ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ | String | æš—å·åŒ–æ¸ˆã¿ | Base64ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‰ |

### ä¼æ¥­ãƒ‡ãƒ¼ã‚¿æ§‹é€ 
```javascript
const companyData = {
  name: String,           // ä¼æ¥­å
  url: String,           // ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆURL
  industry: String,      // æ¥­ç•Œ
  size: String,          // ä¼æ¥­è¦æ¨¡
  contact: Object,       // é€£çµ¡å…ˆæƒ…å ±
  matchScore: Number,    // ãƒãƒƒãƒãƒ³ã‚°ã‚¹ã‚³ã‚¢
  keywords: Array,       // é–¢é€£ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
  lastUpdated: Date      // æœ€çµ‚æ›´æ–°æ—¥
};
```

---

## ğŸš€ ä»Šå¾Œã®å®Ÿè£…è¨ˆç”»

### Phase 1: ç®¡ç†è€…ãƒ»ãƒ¦ãƒ¼ã‚¶ãƒ¼åˆ†é›¢ï¼ˆå„ªå…ˆåº¦ï¼šé«˜ï¼‰
- [ ] AdaptiveMenuSystemã‚¯ãƒ©ã‚¹ã®å®Ÿè£…
- [ ] EnhancedLicenseManagerã‚¯ãƒ©ã‚¹ã®å®Ÿè£…
- [ ] ã‚·ã‚¹ãƒ†ãƒ è¨­å®šã‚·ãƒ¼ãƒˆã®è‡ªå‹•ç”Ÿæˆ
- [ ] ç®¡ç†è€…èªè¨¼ã‚·ã‚¹ãƒ†ãƒ 

### Phase 2: ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ç®¡ç†å¼·åŒ–ï¼ˆå„ªå…ˆåº¦ï¼šä¸­ï¼‰
- [ ] å–¶æ¥­æ—¥ãƒ™ãƒ¼ã‚¹æœŸé™è¨ˆç®—
- [ ] æ—¥æœ¬ã®ç¥æ—¥å¯¾å¿œ
- [ ] èª²é‡‘çŠ¶æ³è¿½è·¡
- [ ] åˆ©ç”¨çµ±è¨ˆæ©Ÿèƒ½

### Phase 3: æ‹¡å¼µæ©Ÿèƒ½ï¼ˆå„ªå…ˆåº¦ï¼šä½ï¼‰
- [ ] ãƒ‡ãƒ¼ã‚¿ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆæ©Ÿèƒ½
- [ ] ã‚·ã‚¹ãƒ†ãƒ è¨ºæ–­æ©Ÿèƒ½
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–
- [ ] è‡ªå‹•æ›´æ–°ãƒã‚§ãƒƒã‚¯

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ä»•æ§˜

### APIåˆ©ç”¨åˆ¶é™
- **ChatGPT API**: 1åˆ†é–“ã‚ãŸã‚Šæœ€å¤§3ãƒªã‚¯ã‚¨ã‚¹ãƒˆ
- **Google Search API**: 1æ—¥ã‚ãŸã‚Š100ã‚¯ã‚¨ãƒª
- **å®Ÿè¡Œæ™‚é–“åˆ¶é™**: 6åˆ†ä»¥å†…

### ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
- **æœ€å¤§å‡¦ç†è¡Œæ•°**: 1,000è¡Œ
- **ä¸€æ™‚ãƒ‡ãƒ¼ã‚¿ä¿å­˜**: PropertiesServiceã‚’æ´»ç”¨
- **ãƒ­ã‚°ä¿æŒæœŸé–“**: 30æ—¥é–“

---

*ã“ã®æŠ€è¡“ä»•æ§˜æ›¸ã¯å–¶æ¥­æ”¯æ´ã‚·ã‚¹ãƒ†ãƒ  v2.0 ã®å®Œå…¨ãªå®Ÿè£…ã‚¬ã‚¤ãƒ‰ã§ã™ã€‚*
  getJapaneseHolidays() {
    const currentYear = new Date().getFullYear();
    return [
      `${currentYear}-01-01`, // å…ƒæ—¥
      `${currentYear}-01-08`, // æˆäººã®æ—¥ï¼ˆç¬¬2æœˆæ›œæ—¥ã®ç°¡æ˜“è¨ˆç®—ï¼‰
      `${currentYear}-02-11`, // å»ºå›½è¨˜å¿µã®æ—¥
      `${currentYear}-03-20`, // æ˜¥åˆ†ã®æ—¥ï¼ˆæ¦‚ç®—ï¼‰
      `${currentYear}-04-29`, // æ˜­å’Œã®æ—¥
      `${currentYear}-05-03`, // æ†²æ³•è¨˜å¿µæ—¥
      `${currentYear}-05-04`, // ã¿ã©ã‚Šã®æ—¥
      `${currentYear}-05-05`, // ã“ã©ã‚‚ã®æ—¥
      `${currentYear}-07-15`, // æµ·ã®æ—¥ï¼ˆç¬¬3æœˆæ›œæ—¥ã®ç°¡æ˜“è¨ˆç®—ï¼‰
      `${currentYear}-08-11`, // å±±ã®æ—¥
      `${currentYear}-09-16`, // æ•¬è€ã®æ—¥ï¼ˆç¬¬3æœˆæ›œæ—¥ã®ç°¡æ˜“è¨ˆç®—ï¼‰
      `${currentYear}-09-22`, // ç§‹åˆ†ã®æ—¥ï¼ˆæ¦‚ç®—ï¼‰
      `${currentYear}-10-14`, // ä½“è‚²ã®æ—¥ï¼ˆç¬¬2æœˆæ›œæ—¥ã®ç°¡æ˜“è¨ˆç®—ï¼‰
      `${currentYear}-11-03`, // æ–‡åŒ–ã®æ—¥
      `${currentYear}-11-23`, // å‹¤åŠ´æ„Ÿè¬ã®æ—¥
      `${currentYear}-12-23`  // å¤©çš‡èª•ç”Ÿæ—¥
    ];
  }
  
  // ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰åˆ¶å¾¡
  toggleAdminMode() {
    const currentMode = this.getAdminModeStatus();
    this.setAdminModeStatus(!currentMode);
    
    // ãƒ¡ãƒ‹ãƒ¥ãƒ¼å†æ§‹ç¯‰ã®ãŸã‚ç”»é¢ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã‚’ä¿ƒã™
    SpreadsheetApp.getUi().alert(
      'ç®¡ç†è€…ãƒ¢ãƒ¼ãƒ‰åˆ‡æ›¿å®Œäº†\n\nãƒšãƒ¼ã‚¸ã‚’æ›´æ–°ã—ã¦ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã®å¤‰æ›´ã‚’åæ˜ ã—ã¦ãã ã•ã„ã€‚'
    );
  }
  
  getAdminModeStatus() {
    return this.settingsSheet.getRange('B2').getValue() === true;
  }
  
  setAdminModeStatus(status) {
    this.settingsSheet.getRange('B2').setValue(status);
    this.settingsSheet.getRange('C2').setValue(
      status ? 'ç®¡ç†è€…ãƒ¡ãƒ‹ãƒ¥ãƒ¼è¡¨ç¤ºä¸­' : 'ä¸€èˆ¬ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ¡ãƒ‹ãƒ¥ãƒ¼'
    );
  }
  
  // ä½¿ç”¨é–‹å§‹æ—¥è¨­å®š
  setLicenseStartDate() {
    const ui = SpreadsheetApp.getUi();
    const response = ui.prompt(
      'ä½¿ç”¨é–‹å§‹æ—¥è¨­å®š',
      'YYYY-MM-DD å½¢å¼ã§ä½¿ç”¨é–‹å§‹æ—¥ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„\nï¼ˆä¾‹: 2025-10-17ï¼‰',
      ui.ButtonSet.OK_CANCEL
    );
    
    if (response.getSelectedButton() === ui.Button.OK) {
      const dateText = response.getResponseText();
      
      if (this.isValidDate(dateText)) {
        this.settingsSheet.getRange('B3').setValue(dateText);
        
        // ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æœŸé™ã‚’è‡ªå‹•è¨ˆç®—
        const expiryDate = this.calculateExpiryDate(new Date(dateText));
        this.settingsSheet.getRange('B6').setValue(this.formatDate(expiryDate));
        
        ui.alert('âœ… è¨­å®šå®Œäº†\n\nä½¿ç”¨é–‹å§‹æ—¥ã‚’è¨­å®šã—ã¾ã—ãŸã€‚\n10å–¶æ¥­æ—¥å¾Œã«æœŸé™åˆ‡ã‚Œã¨ãªã‚Šã¾ã™ã€‚');
      } else {
        ui.alert('âŒ å…¥åŠ›ã‚¨ãƒ©ãƒ¼\n\næ­£ã—ã„æ—¥ä»˜å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
      }
    }
  }
  
  // æœŸé™æ—¥è¨ˆç®—ï¼ˆå–¶æ¥­æ—¥ãƒ™ãƒ¼ã‚¹ï¼‰
  calculateExpiryDate(startDate) {
    const holidays = this.getJapaneseHolidays();
    let businessDaysAdded = 0;
    const current = new Date(startDate);
    
    while (businessDaysAdded < this.trialDays) {
      current.setDate(current.getDate() + 1);
      const dayOfWeek = current.getDay();
      const dateString = this.formatDate(current);
      
      // åœŸæ—¥ç¥æ—¥ã§ãªã„å ´åˆã®ã¿ã‚«ã‚¦ãƒ³ãƒˆ
      if (dayOfWeek !== 0 && dayOfWeek !== 6 && !holidays.includes(dateString)) {
        businessDaysAdded++;
      }
    }
    
    return current;
  }
  
  // èª²é‡‘çŠ¶æ³ç®¡ç†
  manageBilling() {
    const ui = SpreadsheetApp.getUi();
    const currentStatus = this.settingsSheet.getRange('B4').getValue();
    
    let statusText = 'ğŸ’³ èª²é‡‘çŠ¶æ³ç®¡ç†\n\n';
    statusText += `ç¾åœ¨ã®çŠ¶æ³: ${currentStatus}\n\n`;
    
    if (currentStatus === 'trial') {
      statusText += 'è©¦ç”¨æœŸé–“ä¸­ã§ã™ã€‚\n';
      statusText += 'ç¶™ç¶šåˆ©ç”¨ã«ã¯èª²é‡‘ãŒå¿…è¦ã§ã™ã€‚\n\n';
      statusText += 'èª²é‡‘å®Œäº†å¾Œã€ã“ã®ç”»é¢ã§ã€Œpaidã€ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚';
    } else if (currentStatus === 'paid') {
      statusText += 'èª²é‡‘æ¸ˆã¿ã§ã™ã€‚\n';
      statusText += 'ã‚·ã‚¹ãƒ†ãƒ ã¯ç¶™ç¶šåˆ©ç”¨å¯èƒ½ã§ã™ã€‚';
    } else {
      statusText += 'æœŸé™åˆ‡ã‚Œã§ã™ã€‚\n';
      statusText += 'èª²é‡‘å¾Œã€ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’æ›´æ–°ã—ã¦ãã ã•ã„ã€‚';
    }
    
    const response = ui.alert(
      statusText,
      'èª²é‡‘çŠ¶æ³ã‚’ã€Œpaidã€ã«å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ',
      ui.ButtonSet.YES_NO
    );
    
    if (response === ui.Button.YES) {
      this.settingsSheet.getRange('B4').setValue('paid');
      this.settingsSheet.getRange('B5').setValue(this.formatDate(new Date()));
      ui.alert('âœ… æ›´æ–°å®Œäº†\n\nèª²é‡‘çŠ¶æ³ã‚’ã€Œpaidã€ã«å¤‰æ›´ã—ã¾ã—ãŸã€‚');
    }
  }
  
  // ãƒ©ã‚¤ã‚»ãƒ³ã‚¹æœ‰åŠ¹æ€§ãƒã‚§ãƒƒã‚¯
  checkLicenseValidity() {
    const startDateText = this.settingsSheet.getRange('B3').getValue();
    const billingStatus = this.settingsSheet.getRange('B4').getValue();
    
    if (!startDateText) {
      return { isValid: false, reason: 'ä½¿ç”¨é–‹å§‹æ—¥ãŒæœªè¨­å®š' };
    }
    
    if (billingStatus === 'paid') {
      return { isValid: true, reason: 'èª²é‡‘æ¸ˆã¿' };
    }
    
    const startDate = new Date(startDateText);
    const today = new Date();
    const businessDaysUsed = this.calculateBusinessDays(startDate, today);
    
    if (businessDaysUsed >= this.trialDays) {
      return { isValid: false, reason: 'è©¦ç”¨æœŸé–“çµ‚äº†' };
    }
    
    return { 
      isValid: true, 
      reason: `è©¦ç”¨æœŸé–“ä¸­ï¼ˆæ®‹ã‚Š${this.trialDays - businessDaysUsed}å–¶æ¥­æ—¥ï¼‰` 
    };
  }
  
  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£é–¢æ•°
  isValidDate(dateString) {
    const regex = /^\d{4}-\d{2}-\d{2}$/;
    if (!regex.test(dateString)) return false;
    
    const date = new Date(dateString);
    return date instanceof Date && !isNaN(date);
  }
  
  formatDate(date) {
    return date.toISOString().split('T')[0];
  }
  
  encryptPassword(password) {
    // ç°¡æ˜“æš—å·åŒ–ï¼ˆå®Ÿéš›ã®é‹ç”¨ã§ã¯ã‚ˆã‚Šå¼·åŠ›ãªæš—å·åŒ–ã‚’æ¨å¥¨ï¼‰
    return Utilities.base64Encode(password);
  }
}
```

#### 2. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° (`debug.js`)
```javascript
// åŒ…æ‹¬çš„ã‚¨ãƒ©ãƒ¼å‡¦ç†
class ErrorHandler {
  safeExecute(func, funcName, ...args) {
    try {
      console.log(`[DEBUG] Starting: ${funcName}`);
      const result = func.apply(this, args);
      console.log(`[DEBUG] Completed: ${funcName}`);
      return result;
    } catch (error) {
      this.logError(funcName, error);
      throw new DetailedError(funcName, error);
    }
  }
  
  logError(funcName, error) {
    const errorLog = {
      timestamp: new Date().toISOString(),
      function: funcName,
      error: error.toString(),
      stack: error.stack
    };
    
    Logger.log(JSON.stringify(errorLog));
    this.saveErrorToSheet(errorLog);
  }
}
```

---

## ğŸ”§ APIçµ±åˆä»•æ§˜

### OpenAI ChatGPT API

#### èªè¨¼
```javascript
const OPENAI_API_KEY = PropertiesService.getScriptProperties().getProperty('OPENAI_API_KEY');

const headers = {
  'Authorization': `Bearer ${OPENAI_API_KEY}`,
  'Content-Type': 'application/json'
};
```

#### ãƒªã‚¯ã‚¨ã‚¹ãƒˆå½¢å¼
```javascript
const payload = {
  model: 'gpt-3.5-turbo',
  messages: [
    {
      role: 'system',
      content: 'ã‚·ã‚¹ãƒ†ãƒ ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ'
    },
    {
      role: 'user',
      content: 'ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›'
    }
  ],
  max_tokens: 2000,
  temperature: 0.7
};
```

#### ãƒ¬ã‚¹ãƒãƒ³ã‚¹å‡¦ç†
```javascript
function parseOpenAIResponse(response) {
  const data = JSON.parse(response.getContentText());
  
  if (data.error) {
    throw new Error(`OpenAI API Error: ${data.error.message}`);
  }
  
  return {
    content: data.choices[0].message.content,
    usage: data.usage,
    model: data.model
  };
}
```

### Google Custom Search API

#### èªè¨¼ãƒ»è¨­å®š
```javascript
const GOOGLE_SEARCH_API_KEY = PropertiesService.getScriptProperties().getProperty('GOOGLE_SEARCH_API_KEY');
const SEARCH_ENGINE_ID = PropertiesService.getScriptProperties().getProperty('GOOGLE_SEARCH_ENGINE_ID');
```

#### æ¤œç´¢å®Ÿè¡Œ
```javascript
function executeGoogleSearch(query, options = {}) {
  const baseUrl = 'https://www.googleapis.com/customsearch/v1';
  const params = {
    key: GOOGLE_SEARCH_API_KEY,
    cx: SEARCH_ENGINE_ID,
    q: query,
    num: options.num || 10,
    start: options.start || 1,
    lr: 'lang_ja',
    cr: 'countryJP'
  };
  
  const url = `${baseUrl}?${Object.entries(params).map(([k,v]) => `${k}=${encodeURIComponent(v)}`).join('&')}`;
  
  const response = UrlFetchApp.fetch(url);
  return JSON.parse(response.getContentText());
}
```

---

## ğŸ’¾ ãƒ‡ãƒ¼ã‚¿ç®¡ç†ä»•æ§˜

### ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆæ§‹é€ 

#### åˆ¶å¾¡ãƒ‘ãƒãƒ«ã‚·ãƒ¼ãƒˆ
```yaml
Row 1: ãƒ˜ãƒƒãƒ€ãƒ¼
Row 2-10: åŸºæœ¬è¨­å®š
  - B2: å•†æå
  - B3: å•†ææ¦‚è¦
  - B4: ä¾¡æ ¼å¸¯
  - B5: å¯¾è±¡ä¼æ¥­è¦æ¨¡
  - B6: æœ€å¤§ä¼æ¥­æ•°
  - B7: ChatGPT API Key
  - B8: Google Search API Key
  - B9: Search Engine ID
Row 12-20: å®Ÿè¡Œãƒœã‚¿ãƒ³
Row 22-30: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¡¨ç¤º
```

#### ä¼æ¥­ãƒã‚¹ã‚¿ãƒ¼ã‚·ãƒ¼ãƒˆ
```yaml
Columns:
  A: ä¼æ¥­ID (UUID)
  B: ä¼æ¥­å
  C: æ¥­ç•Œ
  D: ä¼æ¥­è¦æ¨¡
  E: å¾“æ¥­å“¡æ•°
  F: ã‚¦ã‚§ãƒ–ã‚µã‚¤ãƒˆ
  G: é€£çµ¡å…ˆæƒ…å ±
  H: ãƒãƒƒãƒåº¦ã‚¹ã‚³ã‚¢
  I: ç™ºè¦‹ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
  J: æœ€çµ‚æ›´æ–°æ—¥æ™‚
  K: ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹
  L: å‚™è€ƒ
```

### ãƒ‡ãƒ¼ã‚¿ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
```javascript
const ValidationRules = {
  companyName: {
    required: true,
    minLength: 2,
    maxLength: 100,
    pattern: /^[^<>{}[\]\\]+$/
  },
  
  employees: {
    type: 'number',
    min: 0,
    max: 1000000
  },
  
  matchScore: {
    type: 'number',
    min: 0,
    max: 100
  },
  
  website: {
    pattern: /^https?:\/\/.+/
  }
};
```

---

## ğŸ”„ ãƒ—ãƒ­ã‚»ã‚¹ãƒ•ãƒ­ãƒ¼

### å…¨è‡ªå‹•ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
```mermaid
sequenceDiagram
    participant U as User
    participant S as System
    participant C as ChatGPT
    participant G as Google Search
    
    U->>S: å…¨è‡ªå‹•å®Ÿè¡Œé–‹å§‹
    S->>S: å…¥åŠ›å€¤æ¤œè¨¼
    S->>C: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ç”Ÿæˆè¦æ±‚
    C->>S: ç”Ÿæˆã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰è¿”å´
    S->>S: ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ä¿å­˜
    
    loop å„ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰
        S->>G: ä¼æ¥­æ¤œç´¢è¦æ±‚
        G->>S: æ¤œç´¢çµæœè¿”å´
        S->>S: ä¼æ¥­ãƒ‡ãƒ¼ã‚¿è§£æ
        S->>S: ãƒãƒƒãƒåº¦è¨ˆç®—
        S->>S: ä¼æ¥­ãƒ‡ãƒ¼ã‚¿ä¿å­˜
    end
    
    S->>S: é«˜ã‚¹ã‚³ã‚¢ä¼æ¥­æŠ½å‡º
    loop å„é«˜ã‚¹ã‚³ã‚¢ä¼æ¥­
        S->>C: ææ¡ˆç”Ÿæˆè¦æ±‚
        C->>S: ææ¡ˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸è¿”å´
        S->>S: ææ¡ˆä¿å­˜
    end
    
    S->>U: å®Ÿè¡Œå®Œäº†é€šçŸ¥
```

### ã‚¨ãƒ©ãƒ¼å‡¦ç†ãƒ•ãƒ­ãƒ¼
```mermaid
graph TD
    A[å‡¦ç†é–‹å§‹] --> B{ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿ?}
    B -->|No| C[æ­£å¸¸å®Œäº†]
    B -->|Yes| D[ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥åˆ¤å®š]
    D --> E{API ã‚¨ãƒ©ãƒ¼?}
    E -->|Yes| F[ãƒªãƒˆãƒ©ã‚¤å‡¦ç†]
    F --> G{ãƒªãƒˆãƒ©ã‚¤ä¸Šé™?}
    G -->|No| H[æŒ‡æ•°ãƒãƒƒã‚¯ã‚ªãƒ•å¾…æ©Ÿ]
    H --> B
    G -->|Yes| I[ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ²]
    E -->|No| J{ãƒ‡ãƒ¼ã‚¿ã‚¨ãƒ©ãƒ¼?}
    J -->|Yes| K[ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒªãƒ¼ãƒ‹ãƒ³ã‚°]
    K --> B
    J -->|No| L[ã‚·ã‚¹ãƒ†ãƒ ã‚¨ãƒ©ãƒ¼]
    I --> M[ãƒ¦ãƒ¼ã‚¶ãƒ¼é€šçŸ¥]
    L --> M
    M --> N[å‡¦ç†çµ‚äº†]
```

---

## ğŸš€ ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### APIå‘¼ã³å‡ºã—æœ€é©åŒ–
```javascript
class APIRateLimiter {
  constructor(maxRequestsPerMinute = 60) {
    this.maxRequests = maxRequestsPerMinute;
    this.requests = [];
  }
  
  async execute(apiCall) {
    await this.waitIfNeeded();
    this.requests.push(Date.now());
    
    try {
      return await apiCall();
    } catch (error) {
      if (this.isRateLimitError(error)) {
        await this.exponentialBackoff();
        return this.execute(apiCall);
      }
      throw error;
    }
  }
  
  async waitIfNeeded() {
    const now = Date.now();
    const oneMinuteAgo = now - 60000;
    
    this.requests = this.requests.filter(time => time > oneMinuteAgo);
    
    if (this.requests.length >= this.maxRequests) {
      const waitTime = this.requests[0] - oneMinuteAgo;
      await this.sleep(waitTime);
    }
  }
}
```

### ãƒ¡ãƒ¢ãƒªç®¡ç†
```javascript
class MemoryManager {
  static clearCache() {
    // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢
    SpreadsheetApp.flush();
    
    // å¤§ããªã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’å‰Šé™¤
    if (typeof globalThis.largeCacheObject !== 'undefined') {
      delete globalThis.largeCacheObject;
    }
    
    // ã‚¬ãƒ™ãƒ¼ã‚¸ã‚³ãƒ¬ã‚¯ã‚·ãƒ§ãƒ³æ¨å¥¨
    Utilities.sleep(100);
  }
  
  static batchProcess(items, batchSize = 10, processor) {
    const results = [];
    
    for (let i = 0; i < items.length; i += batchSize) {
      const batch = items.slice(i, i + batchSize);
      const batchResults = processor(batch);
      results.push(...batchResults);
      
      // ãƒãƒƒãƒé–“ã§ãƒ¡ãƒ¢ãƒªã‚¯ãƒªã‚¢
      if (i % (batchSize * 5) === 0) {
        this.clearCache();
      }
    }
    
    return results;
  }
}
```

---

## ğŸ›¡ï¸ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä»•æ§˜

### API ã‚­ãƒ¼ç®¡ç†
```javascript
class SecureConfigManager {
  static setAPIKey(keyName, keyValue) {
    // æš—å·åŒ–ã—ã¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã‚µãƒ¼ãƒ“ã‚¹ã«ä¿å­˜
    const encrypted = this.encrypt(keyValue);
    PropertiesService.getScriptProperties().setProperty(keyName, encrypted);
  }
  
  static getAPIKey(keyName) {
    const encrypted = PropertiesService.getScriptProperties().getProperty(keyName);
    return encrypted ? this.decrypt(encrypted) : null;
  }
  
  static encrypt(text) {
    // ç°¡æ˜“æš—å·åŒ–ï¼ˆå®Ÿè£…ã§ã¯å¼·åŠ›ãªæš—å·åŒ–ã‚’æ¨å¥¨ï¼‰
    return Utilities.base64Encode(text);
  }
  
  static decrypt(encryptedText) {
    return Utilities.base64Decode(encryptedText);
  }
}
```

### å…¥åŠ›å€¤ã‚µãƒ‹ã‚¿ã‚¤ã‚¼ãƒ¼ã‚·ãƒ§ãƒ³
```javascript
class InputSanitizer {
  static sanitizeText(input) {
    if (typeof input !== 'string') return '';
    
    return input
      .replace(/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi, '') // ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚¿ã‚°é™¤å»
      .replace(/[<>'"&]/g, (match) => {
        const escapeMap = {
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#x27;',
          '&': '&amp;'
        };
        return escapeMap[match];
      })
      .trim()
      .substring(0, 1000); // é•·ã•åˆ¶é™
  }
  
  static validateEmail(email) {
    const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return emailRegex.test(email);
  }
  
  static validateURL(url) {
    try {
      new URL(url);
      return url.startsWith('http://') || url.startsWith('https://');
    } catch {
      return false;
    }
  }
}
```

---

## ğŸ“Š ãƒ­ã‚°ãƒ»ãƒ¢ãƒ‹ã‚¿ãƒªãƒ³ã‚°ä»•æ§˜

### çµ±åˆãƒ­ã‚°ã‚·ã‚¹ãƒ†ãƒ 
```javascript
class Logger {
  static log(level, message, context = {}) {
    const logEntry = {
      timestamp: new Date().toISOString(),
      level: level.toUpperCase(),
      message: message,
      context: context,
      sessionId: this.getSessionId()
    };
    
    // Console.log
    console.log(JSON.stringify(logEntry));
    
    // Stackdriver Logging
    Logger.log(JSON.stringify(logEntry));
    
    // ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆãƒ­ã‚°
    this.writeToSheet(logEntry);
  }
  
  static info(message, context) {
    this.log('info', message, context);
  }
  
  static error(message, error, context) {
    this.log('error', message, {
      ...context,
      error: error.toString(),
      stack: error.stack
    });
  }
  
  static writeToSheet(logEntry) {
    try {
      const sheet = this.getLogSheet();
      sheet.appendRow([
        logEntry.timestamp,
        logEntry.level,
        logEntry.message,
        JSON.stringify(logEntry.context)
      ]);
    } catch (error) {
      // ãƒ­ã‚°æ›¸ãè¾¼ã¿ã‚¨ãƒ©ãƒ¼ã¯ç„¡è¦–ï¼ˆç„¡é™ãƒ«ãƒ¼ãƒ—é˜²æ­¢ï¼‰
    }
  }
}
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆä»•æ§˜

### å˜ä½“ãƒ†ã‚¹ãƒˆä¾‹
```javascript
class TestSuite {
  static runAllTests() {
    const results = [];
    
    results.push(this.testKeywordGeneration());
    results.push(this.testScoreCalculation());
    results.push(this.testDataValidation());
    
    return results;
  }
  
  static testScoreCalculation() {
    const testData = {
      companySize: 'ä¸­å°ä¼æ¥­',
      industry: 'IT',
      contactMethod: 'email',
      description: 'ãƒ†ã‚¹ãƒˆä¼æ¥­'
    };
    
    const settings = {
      targetSize: 'ä¸­å°ä¼æ¥­',
      targetIndustry: 'IT'
    };
    
    const score = calculateMatchScore(testData, settings);
    
    return {
      test: 'Score Calculation',
      passed: score >= 60 && score <= 100,
      result: score
    };
  }
}
```

---

## ğŸš€ ãƒ‡ãƒ—ãƒ­ã‚¤ãƒ¡ãƒ³ãƒˆ

### Claspè¨­å®š
```json
{
  "scriptId": "1CJc_NYpMJ8veccfqtRbcf0C02a5eR24zcUxGJiP7SU_pf4g-vK6AHfSy",
  "parentId": ["1Q4i_GjDX1x_hWbqvRJDrmqizZMOZ8q-FjX_pf7eGPlM"],
  "rootDir": "./src"
}
```

### è‡ªå‹•ãƒ‡ãƒ—ãƒ­ã‚¤æ‰‹é †
```bash
# 1. ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´
git add .
git commit -m "æ©Ÿèƒ½è¿½åŠ "

# 2. Google Apps Scriptã«ãƒ—ãƒƒã‚·ãƒ¥
npx clasp push

# 3. æœ¬ç•ªç’°å¢ƒãƒ†ã‚¹ãƒˆ
npx clasp open

# 4. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¿ã‚°ä½œæˆ
git tag v2.0.1
git push origin v2.0.1
```

---

*æœ€çµ‚æ›´æ–°: 2025å¹´10æœˆ17æ—¥*  
*æŠ€è¡“ä»•æ§˜æ›¸ v2.0*
